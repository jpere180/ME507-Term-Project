<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME 507: Mouse Droid: Src/reflectance_array.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="MouseDroid-ROStickerBook.webp"/></td>
  <td id="projectalign">
   <div id="projectname">ME 507: Mouse Droid<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">This is a portfolio for the ME507 term project. This objective of this project is to develop a line following robot that mimics the behavior of the Star Wars mouse droid, also known as MSE-6. This droid utilizes a line following array sensor, a ultrasonic sensor, and a speaker.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">reflectance_array.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Reflectance array source file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="reflectance__array_8h_source.html">reflectance_array.h</a>&quot;</code><br />
<code>#include &quot;stm32f4xx_hal.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae847122c9c336d02cb22f51bf0005840" id="r_ae847122c9c336d02cb22f51bf0005840"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae847122c9c336d02cb22f51bf0005840">read_sensor</a> (<a class="el" href="structreflect.html">reflect</a> *ref, int pin_num)</td></tr>
<tr class="memdesc:ae847122c9c336d02cb22f51bf0005840"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single reflectance sensor and calculate the decay time.  <br /></td></tr>
<tr class="separator:ae847122c9c336d02cb22f51bf0005840"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08809cb41a150dd2163b5f7d6b81b00d" id="r_a08809cb41a150dd2163b5f7d6b81b00d"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a08809cb41a150dd2163b5f7d6b81b00d">direction</a> (<a class="el" href="structreflect.html">reflect</a> *ref)</td></tr>
<tr class="memdesc:a08809cb41a150dd2163b5f7d6b81b00d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the centroid position based on reflectance sensor readings.  <br /></td></tr>
<tr class="separator:a08809cb41a150dd2163b5f7d6b81b00d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36104db874d93bc3ca96f6c09918053d" id="r_a36104db874d93bc3ca96f6c09918053d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a36104db874d93bc3ca96f6c09918053d">calibrate</a> (<a class="el" href="structreflect.html">reflect</a> *ref)</td></tr>
<tr class="memdesc:a36104db874d93bc3ca96f6c09918053d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibrate the reflectance sensor by finding max and min values.  <br /></td></tr>
<tr class="separator:a36104db874d93bc3ca96f6c09918053d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af448c2fdcc2bf54e2acd439f7fe7b289" id="r_af448c2fdcc2bf54e2acd439f7fe7b289"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af448c2fdcc2bf54e2acd439f7fe7b289">cal_max</a> [8] = {1, 1, 1, 1, 1, 1, 1, 1}</td></tr>
<tr class="separator:af448c2fdcc2bf54e2acd439f7fe7b289"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab014b4381f8673a7295dce8240911c59" id="r_ab014b4381f8673a7295dce8240911c59"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab014b4381f8673a7295dce8240911c59">cal_min</a> [8] = {0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF}</td></tr>
<tr class="separator:ab014b4381f8673a7295dce8240911c59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26cdc31651d6dc63aed33e144dc67907" id="r_a26cdc31651d6dc63aed33e144dc67907"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a26cdc31651d6dc63aed33e144dc67907">pos_weight</a> [8] = {1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000}</td></tr>
<tr class="separator:a26cdc31651d6dc63aed33e144dc67907"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac1db55f2739ea44402941ecdadd288c" id="r_aac1db55f2739ea44402941ecdadd288c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aac1db55f2739ea44402941ecdadd288c">count_cal</a> = 0</td></tr>
<tr class="separator:aac1db55f2739ea44402941ecdadd288c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Reflectance array source file. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a36104db874d93bc3ca96f6c09918053d" name="a36104db874d93bc3ca96f6c09918053d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36104db874d93bc3ca96f6c09918053d">&#9670;&#160;</a></span>calibrate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calibrate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structreflect.html">reflect</a> *</td>          <td class="paramname"><span class="paramname"><em>ref</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibrate the reflectance sensor by finding max and min values. </p>
<p>Calibrates the reflectance sensor array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ref</td><td>Pointer to the reflect structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function calibrates the reflectance sensor by taking several readings to determine the maximum and minimum values for each sensor. It counts the number of calibration cycles for debugging purposes. This function assumes the sensor is moved back and forth over a black line and a surface to calibrate properly. </dd></dl>

</div>
</div>
<a id="a08809cb41a150dd2163b5f7d6b81b00d" name="a08809cb41a150dd2163b5f7d6b81b00d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08809cb41a150dd2163b5f7d6b81b00d">&#9670;&#160;</a></span>direction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float direction </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structreflect.html">reflect</a> *</td>          <td class="paramname"><span class="paramname"><em>ref</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the centroid position based on reflectance sensor readings. </p>
<p>Determines the direction based on sensor readings.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ref</td><td>Pointer to the reflect structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">Centroid</td><td>position (range from 1000 to 8000). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function reads the reflectance sensor values, calculates the percentage of the maximum and minimum values, and computes the weighted average to estimate the centroid position. </dd></dl>

</div>
</div>
<a id="ae847122c9c336d02cb22f51bf0005840" name="ae847122c9c336d02cb22f51bf0005840"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae847122c9c336d02cb22f51bf0005840">&#9670;&#160;</a></span>read_sensor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t read_sensor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structreflect.html">reflect</a> *</td>          <td class="paramname"><span class="paramname"><em>ref</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>pin_num</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single reflectance sensor and calculate the decay time. </p>
<p>Reads the value from a specified sensor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ref</td><td>Pointer to the reflect structure. </td></tr>
    <tr><td class="paramname">pin_num</td><td>Pin number within the reflectance sensor array (1 to 8). </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">Decay</td><td>time of the sensor in milliseconds. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function reads the decay time of a specified reflectance sensor, which is connected to a specified pin, and returns the decay time in milliseconds. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af448c2fdcc2bf54e2acd439f7fe7b289" name="af448c2fdcc2bf54e2acd439f7fe7b289"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af448c2fdcc2bf54e2acd439f7fe7b289">&#9670;&#160;</a></span>cal_max</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t cal_max[8] = {1, 1, 1, 1, 1, 1, 1, 1}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Array to store maximum values for calibration. Initialized to small non-zero values. </p>

</div>
</div>
<a id="ab014b4381f8673a7295dce8240911c59" name="ab014b4381f8673a7295dce8240911c59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab014b4381f8673a7295dce8240911c59">&#9670;&#160;</a></span>cal_min</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t cal_min[8] = {0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Array to store minimum values for calibration. Initialized to large values. </p>

</div>
</div>
<a id="aac1db55f2739ea44402941ecdadd288c" name="aac1db55f2739ea44402941ecdadd288c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac1db55f2739ea44402941ecdadd288c">&#9670;&#160;</a></span>count_cal</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int count_cal = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Counter to track the number of calibration cycles. </p>

</div>
</div>
<a id="a26cdc31651d6dc63aed33e144dc67907" name="a26cdc31651d6dc63aed33e144dc67907"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26cdc31651d6dc63aed33e144dc67907">&#9670;&#160;</a></span>pos_weight</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pos_weight[8] = {1000, 2000, 3000, 4000, 5000, 6000, 7000, 8000}</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Weighted positions for centroid calculation. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
